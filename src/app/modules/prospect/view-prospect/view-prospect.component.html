<div class="w-100 d-flex justify-content-between">
  <div class="p-2 d-flex justify-content-end">
    <button
      (click)="exportListToExcel()"
      [disabled]="checkedIds.length < 1"
      nz-button
      nzType="primary"
    >
      Export Selected
    </button>
  </div>
  <div nz-row>
    <div class="p-2 d-flex justify-content-end">
      <button
        (click)="exportCompleteListToExcel()"
        [disabled]="checkedIds.length >= 1"
        nz-button
        nzType="primary"
      >
        Export List
      </button>
    </div>
    <div *ngIf="!achievedTable" class="p-2 d-flex justify-content-end">
      <button (click)="addProspect()" nz-button nzType="primary">
        Add Prospect
      </button>
    </div>
  </div>
</div>

<div class="m-2 box-shadow">
  <nz-table
    #borderedTable
    (nzCurrentPageDataChange)="onCurrentPageDataChange($event)"
    (nzQueryParams)="onQueryParamsChange($event)"
    [nzData]="dataSet"
    [nzFrontPagination]="false"
    [nzLoading]="isLoading"
    [nzPageIndex]="pageIndex"
    [nzPageSizeOptions]="[8, 10, 20, 30, 40, 50]"
    [nzPageSize]="pageSize"
    [nzScroll]="{ x: '1100px', y: '640px' }"
    [nzTotal]="total"
    class="w-100"
    nzBordered
    nzShowSizeChanger
    nzSize="small"
    nzTableLayout="fixed"
  >
    <thead>
    <tr class="align-content-center">
      <th
        (nzCheckedChange)="onAllChecked($event)"
        [(nzChecked)]="checked"
        [nzIndeterminate]="indeterminate"
        nzEllipsis
        nzWidth="80px"
      ></th>
      <th
        *ngFor="let column of listOfColumns; let i = index"
        [nz-tooltip]="column.tooltipText"
        [nzColumnKey]="listOfFilter[i]"
        [nzCustomFilter]="column.name !== 'Video Link'"
        [nzLeft]="column.name === 'First Name'"
        [nzSortFn]="true"
        [nzWidth]="column.width"
        class="text-align-left"
        nzEllipsis
      >
        {{ column.name }}

        <nz-filter-trigger
          *ngIf="column.name !== 'Video Link'"
          [(nzVisible)]="visible[listOfFilter?.[i]]"
          [nzActive]="searchValue[listOfFilter[i]]?.length > 0"
          [nzDropdownMenu]="menu"
        >
          <span nz-icon nzType="search"></span>
        </nz-filter-trigger>
        <nz-dropdown-menu #menu="nzDropdownMenu">
          <div class="ant-table-filter-dropdown">
            <div class="search-box">
              <input
                *ngIf="
                    column.name !== 'Positions' &&
                    column.name !== 'State/Province' &&
                    column.name !== 'School/Team'
                  "
                [(ngModel)]="searchValue[listOfFilter[i]]"
                [placeholder]="'Search ' + column.name"
                nz-input
                type="text"
              />
              <app-position-multi-select
                *ngIf="column.name === 'Positions'"
                [formControl]="positionSearchFormControl"
              ></app-position-multi-select>

              <app-states-select-search
                *ngIf="column.name === 'State/Province'"
                [formControl]="stateSearchFormControl"
              >
              </app-states-select-search>
              <app-school-select-search
                *ngIf="column.name === 'School/Team'"
                [formControl]="schoolSearchFormControl"
              >
              </app-school-select-search>

              <button
                (click)="search(listOfFilter[i])"
                class="search-button"
                nz-button
                nzSize="small"
                nzType="primary"
              >
                Search
              </button>
              <button
                (click)="reset(listOfFilter[i])"
                nz-button
                nzSize="small"
              >
                Reset
              </button>
            </div>
          </div>
        </nz-dropdown-menu>
      </th>
      <th
        class="text-align-left .ant-table-column-title"
        nzRight
        nzWidth="150px"
        style="color: white"
      >
        Action
      </th>
    </tr>
    </thead>
    <tbody>
    <tr *ngIf="showRow" [formGroup]="prospectForm" class="text-align-left">
      <td></td>
      <td>
          <span>
            <input formControlName="first_name" nz-input/>
          </span>
      </td>
      <td>
          <span>
            <input formControlName="last_name" nz-input/>
          </span>
      </td>
      <td>
          <span>
            <nz-select
              formControlName="position"
              nzMode="multiple"
              class="w-100 select"
              nzPlaceHolder="Select a position"
            >
              <nz-option
                *ngFor="let position of positions"
                [nzLabel]="position.position_name"
                [nzValue]="position.id"
              ></nz-option>
            </nz-select>
          </span>
      </td>
      <td>
          <span>
            <input formControlName="classification" nz-input/>
          </span>
      </td>
      <td>
          <span>
            <app-states-select-search
              formControlName="state"
            ></app-states-select-search>
          </span>
      </td>
      <td>
          <span>
            <app-school-select-search formControlName="school">
            </app-school-select-search>
          </span>
      </td>

      <td>
          <span>
            <input formControlName="video_link" nz-input/>
          </span>
      </td>
      <td class="d-flex justify-content-center" nzRight>
        <a (click)="isSaveNew(false)" class="p-2">
          <i
            [nzTheme]="'twotone'"
            [nzTooltipColor]="'blue'"
            [nzTooltipTitle]="'Save Prospect'"
            [nzTwotoneColor]="'#46c40a'"
            nz-icon
            nz-tooltip
            nzType="save"
          ></i>
        </a>
        <a
          (nzOnCancel)="cancel()"
          (nzOnConfirm)="confirm()"
          [nzTooltipColor]="'blue'"
          [nzTooltipTitle]="'Discard changes'"
          class="p-2"
          nz-popconfirm
          nz-tooltip
          nzPopconfirmPlacement="top"
          nzPopconfirmTitle="Are you sure you want to discard changes?"
        >
          <i
            [nzTheme]="'twotone'"
            [nzTwotoneColor]="'#c00206'"
            nz-icon
            nzType="close-circle"
          ></i>
        </a>
        <a
          (click)="isSaveNew(true)"
          [nzTooltipColor]="'blue'"
          [nzTooltipTitle]="'Add New Prospect'"
          class="p-2"
          nz-tooltip
        >
          <i
            [nzTheme]="'twotone'"
            [nzTwotoneColor]="'#f5d50a'"
            nz-icon
            nzType="plus-circle"
          ></i>
        </a>
      </td>
    </tr>
    <tr
      *ngFor="let data of borderedTable.data; let i = index"
      [class.stripes]="i % 2 != 0"
      [formGroup]="prospectForm"
      class="text-align-left"
    >
      <td
        (nzCheckedChange)="onItemChecked(data.id, $event)"
        [nzChecked]="setOfCheckedId.has(data.id)"
        [nzShowCheckbox]="!(currentEditIndex === i)"
      ></td>
      <td nzEllipsis nzLeft>
          <span
            *ngIf="currentEditIndex != i"
            [nzTooltipColor]="'blue'"
            [nzTooltipTitle]="data.first_name"
            nz-tooltip
          >
            {{ data.first_name }}
          </span>
        <span *ngIf="currentEditIndex == i">
            <input
              [value]="data.first_name"
              formControlName="first_name"
              nz-input
            />
          </span>
      </td>
      <td nzEllipsis>
          <span
            *ngIf="currentEditIndex != i"
            [nzTooltipColor]="'blue'"
            [nzTooltipTitle]="data.last_name"
            nz-tooltip
          >
            {{ data.last_name }}
          </span>
        <span *ngIf="currentEditIndex == i">
            <input formControlName="last_name" nz-input/>
          </span>
      </td>
      <td class="posData">
          <span *ngIf="currentEditIndex != i">
            <span
              *ngFor="let position of data.pos; last as isLast"
              [nzTooltipColor]="'blue'"
              [nzTooltipTitle]="position.position_name"
              nz-tooltip
            >{{ position.position_name }} {{ isLast ? "" : ", " }}</span
            >
          </span>
        <span *ngIf="currentEditIndex == i">
            <nz-select
              formControlName="position"
              nzMode="multiple"
              class="w-100 select"
              nzPlaceHolder="Select a position"
            >
              <nz-option
                *ngFor="let position of positions"
                [nzLabel]="position.position_name"
                [nzValue]="position.id"
              ></nz-option>
            </nz-select>
          </span>
      </td>
      <td nzEllipsis>
          <span
            *ngIf="currentEditIndex != i"
            [nzTooltipColor]="'blue'"
            [nzTooltipTitle]="data.classification"
            nz-tooltip
          >
            {{ data.classification }}
          </span>
        <span *ngIf="currentEditIndex == i">
            <input formControlName="classification" nz-input/>
          </span>
      </td>
      <td nzEllipsis>
          <span
            *ngIf="currentEditIndex != i"
            [nzTooltipColor]="'blue'"
            [nzTooltipTitle]="data.state"
            nz-tooltip
          >
            {{ data.state }}
          </span>
        <span *ngIf="currentEditIndex == i">
            <app-states-select-search formControlName="state">
            </app-states-select-search>
          </span>
      </td>
      <td nzEllipsis>
          <span
            *ngIf="currentEditIndex != i"
            [nzTooltipColor]="'blue'"
            [nzTooltipTitle]="data.school"
            nz-tooltip
          >
            {{ data.school }}
          </span>
        <span *ngIf="currentEditIndex == i">
            <app-school-select-search formControlName="school">
            </app-school-select-search>
          </span>
      </td>

      <td nzEllipsis>
          <span
            *ngIf="currentEditIndex != i"
            [nzTooltipColor]="'blue'"
            [nzTooltipTitle]="data.video_link"
            nz-tooltip
          >
            {{ data.video_link }}
          </span>
        <span *ngIf="currentEditIndex == i">
            <input formControlName="video_link" nz-input/>
          </span>
      </td>
      <td class="d-flex justify-content-center align-items-center" nzRight>
        <a
          (click)="isEdit(i)"
          *ngIf="currentEditIndex != i"
          [nzTooltipColor]="'blue'"
          [nzTooltipTitle]="'Edit Prospect'"
          class="p-2"
          nz-tooltip
        >
          <i [nzTheme]="'twotone'" nz-icon nzType="edit"></i>
        </a>
        <a
          (click)="isSave(i)"
          *ngIf="currentEditIndex == i"
          [nzTooltipColor]="'blue'"
          [nzTooltipTitle]="'Save changes'"
          class="p-2"
          nz-tooltip
        >
          <i
            [nzTheme]="'twotone'"
            [nzTwotoneColor]="'#46c40a'"
            nz-icon
            nzType="save"
          ></i>
        </a>
        <a
          (nzOnCancel)="cancel()"
          (nzOnConfirm)="confirm()"
          *ngIf="currentEditIndex == i"
          [nzTooltipColor]="'blue'"
          [nzTooltipTitle]="'Discard changes'"
          class="p-2"
          nz-popconfirm
          nz-tooltip
          nzPopconfirmPlacement="top"
          nzPopconfirmTitle="Are you sure you want to discard changes?"
        >
          <i
            [nzTheme]="'twotone'"
            [nzTwotoneColor]="'#c00206'"
            nz-icon
            nzType="close-circle"
          ></i>
        </a>
        <a
          (nzOnCancel)="cancel()"
          (nzOnConfirm)="isDelete(i)"
          *ngIf="currentEditIndex != i"
          [nzTooltipColor]="'blue'"
          [nzTooltipTitle]="'Delete Prospect'"
          class="p-2"
          nz-popconfirm
          nz-tooltip
          nzPopconfirmPlacement="top"
          nzPopconfirmTitle="Are you sure you want to delete prospect?"
        >
          <i
            [nzTheme]="'twotone'"
            [nzTwotoneColor]="'#c00206'"
            nz-icon
            nzType="delete"
          ></i>
        </a>
        <ng-template [ngIf]="!achievedTable">
          <a
            (click)="isArchive(i)"
            *ngIf="currentEditIndex != i"
            [nzTooltipColor]="'blue'"
            [nzTooltipTitle]="'Archive Prospect'"
            class="p-2"
            nz-tooltip
          >
            <i nz-icon nzTheme="outline" nzType="export"></i>
          </a>
        </ng-template>
        <ng-template [ngIf]="achievedTable">
          <a
            (click)="isUnArchive(i)"
            *ngIf="currentEditIndex != i"
            [nzTooltipColor]="'blue'"
            [nzTooltipTitle]="'UnArchive Prospect'"
            class="p-2"
            nz-tooltip
          >
            <i nz-icon nzTheme="outline" nzType="export"></i>
          </a>
        </ng-template>
      </td>
    </tr>
    </tbody>
  </nz-table>
</div>
