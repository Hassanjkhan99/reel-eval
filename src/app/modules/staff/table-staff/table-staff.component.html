<nz-table #borderedTable (nzQueryParams)="onQueryParamsChange($event)"
          [nzData]="listOfData"
          [nzFrontPagination]="false"
          [nzPageIndex]="pageIndex"
          [nzPageSize]="pageSize" [nzTotal]="total"
          [nzPageSizeOptions]="[8,10,20,30,40,50]"
          [nzScroll]="{ y: '640px' , x: '1100px'}"
          nzBordered
          nzShowSizeChanger
          nzTableLayout="fixed"
          class="box-shadow"
>
  <thead>
  <tr>
    <th *ngFor="let column of listOfColumns; let i = index"
        [nzColumnKey]="listOfFilter[i]"
        [nzSortFn]="true"
        [class]="'text-align-left ' + listOfFilter[i]" [nzWidth]="column == 'Email'? '450px' : '250px'"
        nzCustomFilter
    >
      {{column}}
      <nz-filter-trigger *ngIf="column !== 'Actions' && column !== 'Permissions'"
                         [(nzVisible)]="visible[listOfFilter[i]]"
                         [nzActive]="searchValue[listOfFilter[i]].length > 0"
                         [nzDropdownMenu]="menu">
        <span nz-icon nzType="search"></span>
      </nz-filter-trigger>
      <nz-dropdown-menu #menu="nzDropdownMenu">
        <div class="ant-table-filter-dropdown">
          <div class="search-box">
            <input
              [(ngModel)]="searchValue[listOfFilter[i]]"
              [placeholder]="'Search ' + column"
              nz-input
              type="text"
            />
            <button
              (click)="search(listOfFilter[i])"
              class="search-button"
              nz-button
              nzSize="small"
              nzType="primary"
            >
              Search
            </button>
            <button (click)="reset(listOfFilter[i])" nz-button nzSize="small">
              Reset
            </button>
          </div>
        </div>
      </nz-dropdown-menu>

    </th>
    <th class="text-align-left" style="color: white">
      Permissions
    </th>
    <th class="text-align-left" nzRight nzWidth="120px" style="color: white">
      Actions
    </th>
  </tr>
  </thead>
  <tbody>
  <tr *ngFor="let data of borderedTable.data; let i = index" [formGroup]="staffForm"
      class="text-align-left"
      [class.stripes]="i % 2 != 0"
  >

    <td>
      <span *ngIf="currentEditIndex != i">
         {{ data.first_name }}
        </span>
      <span *ngIf="currentEditIndex == i">
          <input class="text-align-center" formControlName="first_name" nz-input/>
        </span>
    </td>
    <td>
      <span *ngIf="currentEditIndex != i">
      {{ data.last_name }}
        </span>
      <span *ngIf="currentEditIndex == i">
          <input class="text-align-center" formControlName="last_name" nz-input/>
        </span>
    </td>
    <td>
      <span *ngIf="currentEditIndex != i">
       {{ data.username }}
        </span>
      <span *ngIf="currentEditIndex == i">
          <input class="text-align-center" formControlName="username" nz-input/>
        </span>
    </td>
    <td>
      <span *ngIf="currentEditIndex != i">
         {{ data.email }}
        </span>
      <span *ngIf="currentEditIndex == i">
          <input class="text-align-center" formControlName="email" nz-input/>
        </span>
    </td>
    <td>
      <span *ngIf="currentEditIndex != i">
         {{ data.group }}
        </span>
      <span *ngIf="currentEditIndex == i">
          <nz-select
            [nzMaxTagPlaceholder]="tagPlaceHolder"
            formControlName="groups"
            nzMode="multiple"
            nzPlaceHolder="Select Permissions"
            class="w-100"
          >
                  <nz-option *ngFor="let permissions of options" [nzLabel]="permissions.name"
                             [nzValue]="permissions.id">
                  </nz-option>
                </nz-select>
        <ng-template #tagPlaceHolder let-selectedList>and {{ selectedList.length }} more selected</ng-template>
        </span>
    </td>
    <td class="d-flex justify-content-center" nzRight>
      <a (click)="isEdit(i)" *ngIf="currentEditIndex != i" [nzTooltipColor]="'blue'" [nzTooltipTitle]="'Edit Staff'"
         class="p-2" nz-tooltip>
        <i [nzTheme]="'twotone'" nz-icon nzType="edit"></i>
      </a>
      <a (click)="isSave(i)" *ngIf="currentEditIndex == i" [nzTooltipColor]="'blue'" [nzTooltipTitle]="'Save changes'"
         class="p-2" nz-tooltip>
        <i
          [nzTheme]="'twotone'"
          [nzTwotoneColor]="'#46c40a'"
          nz-icon
          nzType="save"
        ></i>
      </a>
      <a
        (nzOnCancel)="cancel()"
        (nzOnConfirm)="confirm()"
        *ngIf="currentEditIndex == i"
        class="p-2"
        nz-popconfirm
        nzPopconfirmPlacement="top"
        nzPopconfirmTitle="Are you sure you want to discard changes?"
        [nzTooltipColor]="'blue'" [nzTooltipTitle]="'Discard changes'" nz-tooltip
      >
        <i
          [nzTheme]="'twotone'"
          [nzTwotoneColor]="'#c00206'"
          nz-icon
          nzType="close-circle"
        ></i>
      </a>
      <div
        *ngIf="staffCount != 1" class="p-2"
      >
        <a
          (nzOnCancel)="cancel()"
          (nzOnConfirm)="isDelete(i)"
          *ngIf="currentEditIndex != i"

          nz-popconfirm
          nzPopconfirmPlacement="top"
          nzPopconfirmTitle="Are you sure you want to delete prospect?"
          [nzTooltipColor]="'blue'" [nzTooltipTitle]="'Delete Staff'" nz-tooltip
        >
          <i

            [nzTheme]="'twotone'"
            [nzTwotoneColor]="'#c00206'"
            nz-icon
            nzType="delete"
          ></i>
        </a>
      </div>
    </td>
  </tr>
  </tbody>
</nz-table>





